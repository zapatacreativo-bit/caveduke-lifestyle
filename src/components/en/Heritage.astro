---
// src/components/Heritage.astro
---
<section id="heritage" class="relative py-32 md:py-48 bg-[var(--color-ivory)] overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 md:px-12">
    
    <!-- Header de Sección -->
    <div class="w-full flex flex-col items-center text-center mb-24 reveal-element">
      <div class="flex items-center justify-center gap-3 mb-6">
        <div class="w-8 h-px bg-[var(--color-bordeaux)]"></div>
        <h3 class="font-accent text-[var(--color-bordeaux)] text-xs md:text-sm tracking-[0.2em] uppercase">
          Our Heritage
        </h3>
        <div class="w-8 h-px bg-[var(--color-bordeaux)]"></div>
      </div>

      <h2 class="font-display text-4xl md:text-5xl lg:text-6xl text-[var(--color-noir)] leading-[1.1] max-w-2xl mx-auto">
        Four Decades of<br/>
        <span class="italic font-light text-[var(--color-oak)]">Excellence</span>
      </h2>
    </div>

    <!-- Bloques Narrativos en Z-Pattern -->
    <div class="space-y-32">
      
      <!-- Fila 1: Orígenes -->
      <div class="flex flex-col md:flex-row items-center gap-12 lg:gap-24">
        <div class="w-full md:w-1/2 order-2 md:order-1 reveal-element">
          <div class="font-body text-[15px] md:text-base text-[var(--color-graphite)]/80 leading-[1.85] space-y-6 text-justify">
            <p>
              The history of Caveduke is not written on assembly lines, but with the <em>scent of aged oak</em> and the <em>sound of the chisel</em>. It all began in <strong class="text-[var(--color-bordeaux)] font-semibold not-italic">1985</strong> in a small artisan workshop in <em>Mollet del Vallès, Barcelona</em>. In an era when the concept of a "wine cabinet" was barely understood, our founders had a clear vision: wine, that bottled poetry, deserved a sanctuary worthy of its stature. Not a mere cold and soulless appliance, but an exquisite piece of furniture, crafted from the world's noblest raw materials.
            </p>
            <p>
              From that distant workshop, the first Caveduke creations were born as <strong class="text-[var(--color-noir)] font-medium">exclusive commissions</strong> for private collectors and small châteaux. We rigorously select woods such as <em>walnut, cherry, and solid oak</em>, treated with natural curing processes to prevent any transfer of odors. Our doors are not simple closures; they are glazed triumphal arches that protect your collection from UV rays while allowing it to be proudly displayed.
            </p>
          </div>
        </div>
        
        <div class="w-full md:w-1/2 order-1 md:order-2">
          <div class="aspect-[4/5] overflow-hidden rounded-sm relative img-reveal">
            <div class="absolute inset-0 bg-[#e0d8cd] z-0"></div>
            <img 
              src="/images/heritage.png" 
              alt="Traditional luxury wine cellar" 
              class="w-full h-full object-cover relative z-10 hover:scale-105 transition-transform duration-[2s]"
              loading="eager"
            />
            <div class="absolute inset-0 border border-[var(--color-graphite)]/10 m-4 z-20 pointer-events-none"></div>
          </div>
        </div>
      </div>

      <!-- Fila 2: Innovación & Cita -->
      <div class="flex flex-col md:flex-row items-stretch gap-12 lg:gap-24">
        <div class="w-full md:w-[45%] flex flex-col justify-center">
          <figure class="w-full img-reveal aspect-[16/9] overflow-hidden rounded-sm relative mb-8">
            <div class="absolute inset-0 bg-[#e0d8cd] z-0"></div>
            <img 
              src="/images/craftsman.png" 
              alt="Master cabinetmaker working on a Caveduke wine cabinet in his Barcelona workshop" 
              class="w-full h-full object-cover relative z-10 hover:scale-105 transition-transform duration-[2s]"
              loading="lazy"
            />
            <div class="absolute inset-0 border border-[var(--color-graphite)]/10 m-3 z-20 pointer-events-none"></div>
          </figure>
          
          <div class="reveal-element">
            <blockquote class="border-l-2 border-[var(--color-bordeaux)] pl-5">
              <p class="font-body text-sm md:text-[15px] text-[var(--color-graphite)]/70 leading-relaxed italic">
                "Every wine cabinet is a promise of silence: the silence in which wine perfects its character, far from the noise of the world."
              </p>
              <footer class="mt-3 font-accent text-[10px] tracking-[0.25em] text-[var(--color-bordeaux)]/70 uppercase">
                — Caveduke Founders, 1985
              </footer>
            </blockquote>

            <div class="flex items-center gap-4 pt-4">
              <div class="w-6 h-px bg-[var(--color-graphite)]/20 flex-shrink-0"></div>
              <p class="font-accent text-[10px] tracking-[0.22em] text-[var(--color-graphite)]/40 uppercase">
                Artisanal Design · Barcelona, Spain
              </p>
            </div>
          </div>
        </div>

        <div class="w-full md:w-[55%] flex flex-col justify-center reveal-element">
          <div class="font-body text-[15px] md:text-base text-[var(--color-graphite)]/80 leading-[1.85] text-justify space-y-6">
            <p>
              It was in the early 90s when Caveduke revolutionized the European market by introducing the <em>Climalit glass chamber</em>. Later, we pioneered the integration of damped compression systems: a technology imported from aerospace engineering that guarantees the <strong class="text-[var(--color-bordeaux)] font-semibold">&ldquo;Caveduke Silence&rdquo;</strong> — a total absence of vibrations that allows the wine sediments to rest in infinite peace.
            </p>
            <p>
              We reject common thermoelectric systems due to their instability against environmental spikes. We create a sanctuary where the relative humidity permanently flirts with the perfect figure (65-75%), preventing corks from aging before their wines and ensuring glorious decantations.
            </p>
          </div>
        </div>
      </div>

      <!-- Fila 3: El Legado Actual -->
      <div class="flex flex-col md:flex-row items-center gap-12 lg:gap-24">
        
        <div class="w-full md:w-1/2 order-2 md:order-1 reveal-element">
          <div class="font-body text-[15px] md:text-base text-[var(--color-graphite)]/80 leading-[1.85] text-justify space-y-6">
            <p>
              Today, almost forty years later, <strong class="text-[var(--color-bordeaux)] font-semibold">we categorically reject mass production</strong>. Every Caveduke wine cabinet carries the soul of the cabinetmakers, engineers, and sommeliers who participated in its conception. There is no prefabricated stock; each client enters into an intimate dialogue with our designers, deciding dimensions, tones, capacities, and finishes.
            </p>
            <p>
              Our expansion to <strong class="text-[var(--color-bordeaux)] font-semibold">five continents</strong> has not diminished our workshop spirit; it has magnified it. When a client in <em>New York, Dubai, or Tokyo</em> receives their Caveduke, they are not buying a bottle cooler; they are inheriting a legacy of Spanish design, a vault of imperturbable elegance where time, temperature, and humidity surrender to the beauty of their private collection. Caveduke is, in its purest essence, the aesthetic silence where wine awaits its moment of glory.
            </p>
          </div>
        </div>

        <div class="w-full md:w-1/2 order-1 md:order-2">
          <figure class="w-full img-reveal aspect-[4/3] md:aspect-[5/4] overflow-hidden rounded-sm relative">
            <div class="absolute inset-0 bg-[#e0d8cd] z-0"></div>
            <img 
              src="/images/vinoteca-inline.png" 
              alt="Custom solid walnut Caveduke wine cabinet with interior lighting and UV glass door" 
              class="w-full h-full object-cover relative z-10 hover:scale-105 transition-transform duration-[2s]"
              loading="lazy"
            />
            <div class="absolute inset-0 border border-[var(--color-graphite)]/10 m-3 z-20 pointer-events-none"></div>
            
            <figcaption class="absolute bottom-5 right-5 z-30 bg-[var(--color-ivory)]/90 backdrop-blur px-4 py-2 text-center rounded-sm border border-[var(--color-bordeaux)]/20 text-[var(--color-bordeaux)] shadow-[var(--shadow-gold)] font-accent text-[9px] tracking-[0.2em] uppercase">
              Noble Wood Collection
            </figcaption>
          </figure>
        </div>

      </div>

    </div>

    <!-- Contadores Finales -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-12 sm:gap-6 mt-32 pt-16 border-t border-[var(--color-graphite)]/10 reveal-element">
      
      <div class="flex flex-col items-center text-center">
        <div class="font-display text-6xl md:text-7xl text-[var(--color-bordeaux)] mb-3 flex items-baseline">
          <span class="counter" data-target="40">0</span>
        </div>
        <p class="font-accent text-xs tracking-[0.3em] text-[var(--color-graphite)]/80 uppercase">Years of Craftsmanship</p>
      </div>

      <div class="flex flex-col items-center text-center">
        <div class="font-display text-6xl md:text-7xl text-[var(--color-bordeaux)] mb-3 flex items-baseline">
          <span class="counter" data-target="5">0</span>
        </div>
        <p class="font-accent text-xs tracking-[0.3em] text-[var(--color-graphite)]/80 uppercase">Continents Reached</p>
      </div>

      <div class="flex flex-col items-center text-center">
        <div class="font-display text-6xl md:text-7xl text-[var(--color-bordeaux)] mb-3 flex items-baseline">
          +<span class="counter" data-target="67">0</span>k
        </div>
        <p class="font-accent text-xs tracking-[0.3em] text-[var(--color-graphite)]/80 uppercase">Satisfied Collectors</p>
      </div>

    </div>

  </div>
</section>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // Reveal clip path para todas las imágenes principales
  gsap.utils.toArray('.img-reveal').forEach((wrapper: any) => {
    gsap.fromTo(wrapper, 
      { clipPath: 'inset(100% 0 0 0)' },
      {
        clipPath: 'inset(0% 0 0 0)',
        duration: 1.5,
        ease: 'power4.inOut',
        scrollTrigger: {
          trigger: wrapper,
          start: 'top 80%',
        }
      }
    );
  });

  // Reveal standar para textos y contenedores
  gsap.utils.toArray('.reveal-element').forEach((element: any) => {
    gsap.fromTo(element, 
      { y: 40, opacity: 0 },
      {
        y: 0,
        opacity: 1,
        duration: 1,
        ease: 'power3.out',
        scrollTrigger: {
          trigger: element,
          start: 'top 85%',
        }
      }
    );
  });

  // Animate counters solo cuando llegan a la vista
  const counters = document.querySelectorAll('.counter');
  
  if (counters.length > 0) {
    ScrollTrigger.create({
      trigger: counters[0]?.parentElement?.parentElement?.parentElement, // El grid entero
      start: 'top 85%',
      once: true,
      onEnter: () => {
        counters.forEach(counter => {
          // @ts-ignore
          const target = parseInt(counter.dataset.target);
          gsap.to(counter, {
            innerText: target,
            duration: 2.5,
            snap: { innerText: 1 },
            ease: 'power2.out',
          });
        });
      }
    });
  }
</script>
