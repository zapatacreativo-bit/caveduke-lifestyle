---
// src/components/MicroCTA.astro
// Micro formulario CTA con efecto parallax a mitad de la landing
---
<section class="relative py-32 md:py-40 overflow-hidden">
  <!-- Parallax BG Image -->
  <div class="absolute inset-0 z-0">
    <img 
      src="/images/collections/madera-noble.png" 
      alt="Fondo vinoteca artesanal" 
      class="w-full h-full object-cover parallax-bg scale-110"
      loading="lazy"
      decoding="async"
    />
    <div class="absolute inset-0 bg-[var(--color-noir)]/85"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-[var(--color-noir)] via-transparent to-[var(--color-noir)]"></div>
  </div>

  <div class="relative z-10 max-w-3xl mx-auto px-6 md:px-12 text-center">
    <!-- Headline -->
    <div class="mb-4 micro-cta-reveal">
      <p class="font-accent text-[var(--color-gold)] tracking-widest uppercase text-sm mb-6">Consulta Privada</p>
      <h2 class="font-display text-4xl md:text-5xl lg:text-6xl text-[var(--color-ivory)] leading-[1.1] mb-6">
        Diseñamos su vinoteca <span class="italic text-[var(--color-gold)]">a medida</span>
      </h2>
      <p class="font-body text-[var(--color-silver)]/70 text-lg max-w-xl mx-auto mb-10">
        Reciba un presupuesto personalizado en 24h. Sin compromiso.
      </p>
    </div>

    <!-- Micro Form -->
    <form class="micro-cta-form flex flex-col gap-4 items-center max-w-2xl mx-auto" onsubmit="event.preventDefault(); if(!this.querySelector('#micro-privacy').checked) return; this.querySelector('.micro-success').classList.remove('hidden'); this.querySelector('.micro-fields').classList.add('hidden'); this.querySelector('.micro-privacy-wrap').classList.add('hidden');">
      <div class="micro-fields flex flex-col md:flex-row gap-4 w-full items-stretch">
        <input 
          type="text" 
          placeholder="Su nombre" 
          required
          class="flex-1 bg-[var(--color-noir)]/60 backdrop-blur-sm border border-[var(--color-gold)]/40 text-[var(--color-gold)] placeholder:text-[var(--color-gold)]/40 px-5 py-4 font-body text-sm focus:outline-none focus:border-[var(--color-gold)] transition-colors rounded-sm"
        />
        <input 
          type="email" 
          placeholder="Su email" 
          required
          class="flex-1 bg-[var(--color-noir)]/60 backdrop-blur-sm border border-[var(--color-gold)]/40 text-[var(--color-gold)] placeholder:text-[var(--color-gold)]/40 px-5 py-4 font-body text-sm focus:outline-none focus:border-[var(--color-gold)] transition-colors rounded-sm"
        />
        <button 
          type="submit" 
          class="bg-[var(--color-gold)] text-[var(--color-noir)] font-accent tracking-widest uppercase text-sm px-8 py-4 hover:bg-[var(--color-gold)]/90 transition-all duration-300 flex items-center justify-center gap-2 whitespace-nowrap group rounded-sm"
        >
          Solicitar Presupuesto
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transform group-hover:translate-x-1 transition-transform"><path d="M5 12h14" /><path d="m12 5 7 7-7 7" /></svg>
        </button>
      </div>
      <label class="micro-privacy-wrap flex items-center gap-3 cursor-pointer group mt-2">
        <input type="checkbox" id="micro-privacy" required class="sr-only peer" />
        <div class="w-4 h-4 border border-[var(--color-gold)]/50 peer-checked:border-[var(--color-gold)] peer-checked:bg-[var(--color-gold)] transition-all duration-300 flex items-center justify-center rounded-sm flex-shrink-0">
          <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="var(--color-noir)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="opacity-0 peer-checked:opacity-100 transition-opacity"><path d="M20 6 9 17l-5-5"/></svg>
        </div>
        <span class="font-body text-xs text-[var(--color-gold)]/60 group-hover:text-[var(--color-gold)] transition-colors">
          He leído y acepto la <a href="/politica-de-privacidad" target="_blank" rel="noopener noreferrer" class="underline underline-offset-2 text-[var(--color-gold)]" onclick="event.stopPropagation()">Política de Privacidad</a>
        </span>
      </label>
      <div class="micro-success hidden text-center py-6">
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--color-gold)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-3"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
        <p class="font-display text-2xl text-[var(--color-ivory)] mb-1">¡Recibido!</p>
        <p class="font-body text-sm text-[var(--color-gold)]/70">Le contactaremos en menos de 24h.</p>
      </div>
    </form>

    <p class="font-body text-xs text-[var(--color-silver)]/40 mt-6 micro-cta-reveal">Más de 3.000 vinotecas entregadas desde 1985</p>
  </div>
</section>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // Parallax effect
  gsap.to('.parallax-bg', {
    yPercent: -20,
    ease: 'none',
    scrollTrigger: {
      trigger: '.parallax-bg',
      start: 'top bottom',
      end: 'bottom top',
      scrub: 1
    }
  });

  // Reveal animations
  gsap.fromTo('.micro-cta-reveal',
    { y: 40, opacity: 0 },
    {
      y: 0, opacity: 1, duration: 1, stagger: 0.15, ease: 'power3.out',
      scrollTrigger: { trigger: '.micro-cta-form', start: 'top 85%' }
    }
  );

  gsap.fromTo('.micro-cta-form',
    { y: 30, opacity: 0 },
    {
      y: 0, opacity: 1, duration: 1, ease: 'power3.out',
      scrollTrigger: { trigger: '.micro-cta-form', start: 'top 80%' }
    }
  );
</script>
