---
// src/components/Heritage.astro
---
<section id="legado" class="relative py-32 md:py-48 bg-[var(--color-ivory)] overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 md:px-12 flex flex-col md:flex-row items-start gap-16 lg:gap-32">
    
    <!-- Left Column: Image (sticky) -->
    <div class="w-full md:w-[45%] relative md:sticky md:top-36">
      <div class="aspect-[3/4] overflow-hidden rounded-sm relative heritage-img-wrapper">
        <div class="absolute inset-0 bg-[#e0d8cd] z-0"></div> <!-- Placeholder background -->
        <img 
          src="/images/heritage.png" 
          alt="Bodega de lujo tradicional" 
          class="w-full h-[120%] object-cover absolute top-0 left-0 hover:scale-105 transition-transform duration-[2s] heritage-img"
          loading="eager"
          decoding="async"
        />
        <div class="absolute inset-0 border border-[var(--color-graphite)]/10 m-4 z-10 pointer-events-none"></div>
      </div>
    </div>

    <!-- Right Column: Text & Counters -->
    <div class="w-full md:w-[55%] flex flex-col">
      
      <div class="flex items-center gap-3 mb-8 reveal-element">
        <div class="w-8 h-px bg-[var(--color-bordeaux)]"></div>
        <h3 class="font-accent text-[var(--color-bordeaux)] text-xs md:text-sm tracking-[0.2em] uppercase">
          Nuestra Historia
        </h3>
      </div>

      <h2 class="font-display text-4xl md:text-5xl lg:text-6xl text-[var(--color-noir)] leading-[1.1] mb-8 reveal-element">
        Cuatro Décadas de<br/>
        <span class="italic font-light text-[var(--color-oak)]">Excelencia</span>
      </h2>

      <div class="font-body text-[15px] md:text-base text-[var(--color-graphite)]/80 leading-relaxed max-w-2xl mb-16 reveal-element space-y-6 text-justify">
        <p>
          La historia de Caveduke no se escribe con líneas de ensamblaje, sino con el <strong class="text-[var(--color-noir)] font-semibold">aroma a roble viejo</strong> y el <strong class="text-[var(--color-noir)] font-semibold">sonido del cincel</strong>. Todo comenzó en <strong class="text-[var(--color-bordeaux)] font-semibold">1985</strong> en un pequeño taller artesanal en <strong class="text-[var(--color-noir)] font-semibold">Mollet del Vallès, Barcelona</strong>. En una época donde el concepto de "vinoteca" apenas se entendía, nuestros fundadores tuvieron una visión clara: el vino, esa poesía embotellada, merecía un <strong class="text-[var(--color-bordeaux)] font-semibold">templo a su altura</strong>. No un mero electrodoméstico frío y sin alma, sino una <strong class="text-[var(--color-noir)] font-semibold">pieza de mobiliario exquisita</strong>, confeccionada con las <strong class="text-[var(--color-noir)] font-semibold">materias primas más nobles del mundo</strong>.
        </p>
        <p>
          Desde aquel lejano taller, las primeras Caveduke nacieron como <strong class="text-[var(--color-bordeaux)] font-semibold">encargos exclusivos</strong> para coleccionistas privados y pequeños châteaux. Seleccionamos rigurosamente maderas como el <strong class="text-[var(--color-noir)] font-semibold">nogal, el cerezo y el roble macizo</strong>, tratadas con procesos de curación natural para evitar cualquier transferencia de olores. Nuestras puertas no son simples cierres; son <strong class="text-[var(--color-bordeaux)] font-semibold">arcos de triunfo acristalados</strong> que protegen su colección de los rayos UV mientras permiten su exhibición con orgullo.
        </p>
        <p>
          Fue a principios de los años 90 cuando Caveduke revolucionó el mercado europeo introduciendo la <strong class="text-[var(--color-noir)] font-semibold">cámara de cristal Climalit</strong>. Más tarde, fuimos pioneros en integrar sistemas de <strong class="text-[var(--color-bordeaux)] font-semibold">compresión amortiguada</strong>: una tecnología importada de la <strong class="text-[var(--color-noir)] font-semibold">ingeniería aeroespacial</strong> que garantiza el <strong class="text-[var(--color-bordeaux)] font-semibold">&ldquo;Silencio Caveduke&rdquo;</strong> — una ausencia total de vibraciones que permite que los sedimentos del vino descansen en paz infinita.
        </p>

        <!-- Inline editorial image -->
        <figure class="my-8 heritage-inline-img">
          <div class="overflow-hidden rounded-sm">
            <img 
              src="/images/craftsman.png" 
              alt="Maestro ebanista trabajando en una vinoteca Caveduke en su taller de Barcelona" 
              class="w-full object-cover aspect-[16/9] md:aspect-[21/9] hover:scale-105 transition-transform duration-[2s]"
              loading="lazy"
              decoding="async"
            />
          </div>
          <figcaption class="mt-3 font-accent text-xs tracking-widest text-[var(--color-graphite)]/50 uppercase text-center">
            Taller artesanal · Barcelona, España
          </figcaption>
        </figure>

        <p>
          Hoy, casi cuarenta años después, <strong class="text-[var(--color-bordeaux)] font-semibold">rechazamos categóricamente la producción masiva</strong>. Cada vinoteca Caveduke lleva grabada el alma de los <strong class="text-[var(--color-noir)] font-semibold">ebanistas, ingenieros y sumilleres</strong> que han participado en su concepción. <strong class="text-[var(--color-noir)] font-semibold">No existe el stock prefabricado</strong>; cada cliente entra en un diálogo íntimo con nuestros diseñadores, decidiendo dimensiones, tonos, capacidades y acabados.
        </p>
        <p>
          La expansión a <strong class="text-[var(--color-bordeaux)] font-semibold">cinco continentes</strong> no ha mermado nuestro espíritu de taller, lo ha engrandecido. Cuando un cliente de <strong class="text-[var(--color-noir)] font-semibold">Nueva York, Dubái o Tokio</strong> recibe su Caveduke, no está comprando un enfriador de botellas; está heredando un <strong class="text-[var(--color-bordeaux)] font-semibold">legado del diseño español</strong>, una cámara acorazada de elegancia imperturbable donde el tiempo, la temperatura y la humedad se rinden ante la belleza de su colección privada. Caveduke es, en su esencia más pura, el <strong class="text-[var(--color-bordeaux)] font-semibold">silencio estético donde el vino aguarda su momento de gloria</strong>.
        </p>
      </div>


      <!-- Counters -->
      <div class="grid grid-cols-3 gap-6 md:gap-12 border-t border-[var(--color-graphite)]/10 pt-12 reveal-element">
        
        <div class="flex flex-col">
          <div class="font-display text-5xl md:text-6xl text-[var(--color-noir)] mb-2 flex items-baseline">
            <span class="counter" data-target="40">0</span>
          </div>
          <p class="font-accent text-xs tracking-widest text-[var(--color-graphite)]/60 uppercase">Años</p>
        </div>

        <div class="flex flex-col">
          <div class="font-display text-5xl md:text-6xl text-[var(--color-noir)] mb-2 flex items-baseline">
            <span class="counter" data-target="5">0</span>
          </div>
          <p class="font-accent text-xs tracking-widest text-[var(--color-graphite)]/60 uppercase">Continentes</p>
        </div>

        <div class="flex flex-col">
          <div class="font-display text-5xl md:text-6xl text-[var(--color-noir)] mb-2 flex items-baseline">
            +<span class="counter" data-target="67">0</span>k
          </div>
          <p class="font-accent text-xs tracking-widest text-[var(--color-graphite)]/60 uppercase">Seguidores</p>
        </div>

      </div>

    </div>
  </div>
</section>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // Parallax image
  gsap.to('.heritage-img', {
    yPercent: -20,
    ease: 'none',
    scrollTrigger: {
      trigger: '#legado',
      start: 'top bottom',
      end: 'bottom top',
      scrub: true
    }
  });

  // Reveal clip path image
  gsap.fromTo('.heritage-img-wrapper', 
    { clipPath: 'inset(100% 0 0 0)' },
    {
      clipPath: 'inset(0% 0 0 0)',
      duration: 1.5,
      ease: 'power4.inOut',
      scrollTrigger: {
        trigger: '#legado',
        start: 'top 70%',
      }
    }
  );

  // Reveal text elements
  gsap.fromTo('.reveal-element', 
    { y: 40, opacity: 0 },
    {
      y: 0,
      opacity: 1,
      duration: 1,
      stagger: 0.15,
      ease: 'power3.out',
      scrollTrigger: {
        trigger: '#legado',
        start: 'top 60%',
      }
    }
  );

  // Animate counters
  const counters = document.querySelectorAll('.counter');
  
  ScrollTrigger.create({
    trigger: '.counter',
    start: 'top 80%',
    once: true,
    onEnter: () => {
      counters.forEach(counter => {
        // @ts-ignore
        const target = parseInt(counter.dataset.target);
        gsap.to(counter, {
          innerText: target,
          duration: 2,
          snap: { innerText: 1 },
          ease: 'power2.out',
        });
      });
    }
  });
</script>
