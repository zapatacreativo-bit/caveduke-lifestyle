---
// src/components/Heritage.astro
---
<section id="legado" class="relative py-32 md:py-48 bg-[var(--color-ivory)] overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 md:px-12 flex flex-col md:flex-row items-start gap-16 lg:gap-32">
    
    <!-- Left Column: Image (sticky) -->
    <div class="w-full md:w-[45%] relative md:sticky md:top-36">
      <div class="aspect-[3/4] overflow-hidden rounded-sm relative heritage-img-wrapper">
        <div class="absolute inset-0 bg-[#e0d8cd] z-0"></div> <!-- Placeholder background -->
        <img 
          src="/images/heritage.png" 
          alt="Bodega de lujo tradicional" 
          class="w-full h-[120%] object-cover absolute top-0 left-0 hover:scale-105 transition-transform duration-[2s] heritage-img"
          loading="eager"
          decoding="async"
        />
        <div class="absolute inset-0 border border-[var(--color-graphite)]/10 m-4 z-10 pointer-events-none"></div>
      </div>
    </div>

    <!-- Right Column: Text & Counters -->
    <div class="w-full md:w-[55%] flex flex-col">
      
      <div class="flex items-center gap-3 mb-8 reveal-element">
        <div class="w-8 h-px bg-[var(--color-bordeaux)]"></div>
        <h3 class="font-accent text-[var(--color-bordeaux)] text-xs md:text-sm tracking-[0.2em] uppercase">
          Nuestra Historia
        </h3>
      </div>

      <h2 class="font-display text-4xl md:text-5xl lg:text-6xl text-[var(--color-noir)] leading-[1.1] mb-8 reveal-element">
        Cuatro Décadas de<br/>
        <span class="italic font-light text-[var(--color-oak)]">Excelencia</span>
      </h2>

      <div class="font-body text-[15px] md:text-base text-[var(--color-graphite)]/80 leading-relaxed max-w-2xl mb-16 reveal-element space-y-6 text-justify">
        <p>
          La historia de Caveduke no se escribe con líneas de ensamblaje, sino con el aroma a roble viejo y el sonido del cincel. Todo comenzó en 1985 en un pequeño taller artesanal en Mollet del Vallès, Barcelona. En una época donde el concepto de "vinoteca" apenas se entendía y se reducía a simples neveras industriales modificadas, nuestros fundadores tuvieron una visión clara: el vino, esa poesía embotellada, merecía un templo a su altura. No un mero electrodoméstico frío y sin alma, sino una pieza de mobiliario exquisita, confeccionada con las materias primas más nobles del mundo.
        </p>
        <p>
          Desde aquel lejano taller, las primeras Caveduke nacieron como encargos exclusivos para coleccionistas privados y pequeños châteaux que buscaban proteger sus añadas más preciadas. Cada armario climatizado era —y sigue siendo— una obra única. Seleccionamos rigurosamente maderas como el nogal, el cerezo y el roble macizo, tratadas con procesos de curación natural para evitar cualquier transferencia de olores que pudiera alterar la sublime pureza de los tapones de corcho. Nuestras puertas no son simples cierres; son arcos de triunfo acristalados que protegen su colección de los inclementes rayos UV mientras permiten su exhibición con orgullo.
        </p>
        <p>
          Pero una estética incomparable no sirve de nada sin una técnica impecable. Fue a principios de los años 90 cuando Caveduke revolucionó el mercado europeo introduciendo la cámara de cristal Climalit en sus vinotecas, un avance insólito por aquel entonces. Más tarde, fuimos pioneros en integrar sistemas de compresión amortiguada: una tecnología importada de la ingeniería aeroespacial que garantiza el "Silencio Caveduke", una ausencia total de vibraciones que permite que los sedimentos del vino descansen en paz infinita, envejeciendo con la gracia que solo el tiempo inalterado puede otorgar.
        </p>
        <p>
          Hoy, casi cuarenta años después, seguimos fieles a nuestros orígenes. Rechazamos categóricamente la producción masiva. Cada vinoteca Caveduke que sale de nuestras instalaciones en Barcelona lleva grabada el alma de los ebanistas, ingenieros y sumilleres que han participado en su concepción. No existe el stock prefabricado; cada cliente entra en un diálogo íntimo con nuestros diseñadores, decidiendo dimensiones, tonos, capacidades y acabados para que la vinoteca se integre de forma telepática con la arquitectura de su hogar, mansión o yate.
        </p>
        <p>
          La expansión a cinco continentes no ha mermado nuestro espíritu de taller, lo ha engrandecido. Cuando un cliente de Nueva York, Dubái o Tokio recibe su Caveduke, no está comprando un enfriador de botellas; está heredando un legado del diseño español, una cámara acorazada de elegancia imperturbable donde el tiempo, la temperatura y la humedad se rinden ante la belleza de su colección privada. Caveduke es, en su esencia más pura, el silencio estético donde el vino aguarda su momento de gloria.
        </p>
      </div>

      <!-- Counters -->
      <div class="grid grid-cols-3 gap-6 md:gap-12 border-t border-[var(--color-graphite)]/10 pt-12 reveal-element">
        
        <div class="flex flex-col">
          <div class="font-display text-5xl md:text-6xl text-[var(--color-noir)] mb-2 flex items-baseline">
            <span class="counter" data-target="40">0</span>
          </div>
          <p class="font-accent text-xs tracking-widest text-[var(--color-graphite)]/60 uppercase">Años</p>
        </div>

        <div class="flex flex-col">
          <div class="font-display text-5xl md:text-6xl text-[var(--color-noir)] mb-2 flex items-baseline">
            <span class="counter" data-target="5">0</span>
          </div>
          <p class="font-accent text-xs tracking-widest text-[var(--color-graphite)]/60 uppercase">Continentes</p>
        </div>

        <div class="flex flex-col">
          <div class="font-display text-5xl md:text-6xl text-[var(--color-noir)] mb-2 flex items-baseline">
            +<span class="counter" data-target="67">0</span>k
          </div>
          <p class="font-accent text-xs tracking-widest text-[var(--color-graphite)]/60 uppercase">Seguidores</p>
        </div>

      </div>

    </div>
  </div>
</section>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // Parallax image
  gsap.to('.heritage-img', {
    yPercent: -20,
    ease: 'none',
    scrollTrigger: {
      trigger: '#legado',
      start: 'top bottom',
      end: 'bottom top',
      scrub: true
    }
  });

  // Reveal clip path image
  gsap.fromTo('.heritage-img-wrapper', 
    { clipPath: 'inset(100% 0 0 0)' },
    {
      clipPath: 'inset(0% 0 0 0)',
      duration: 1.5,
      ease: 'power4.inOut',
      scrollTrigger: {
        trigger: '#legado',
        start: 'top 70%',
      }
    }
  );

  // Reveal text elements
  gsap.fromTo('.reveal-element', 
    { y: 40, opacity: 0 },
    {
      y: 0,
      opacity: 1,
      duration: 1,
      stagger: 0.15,
      ease: 'power3.out',
      scrollTrigger: {
        trigger: '#legado',
        start: 'top 60%',
      }
    }
  );

  // Animate counters
  const counters = document.querySelectorAll('.counter');
  
  ScrollTrigger.create({
    trigger: '.counter',
    start: 'top 80%',
    once: true,
    onEnter: () => {
      counters.forEach(counter => {
        // @ts-ignore
        const target = parseInt(counter.dataset.target);
        gsap.to(counter, {
          innerText: target,
          duration: 2,
          snap: { innerText: 1 },
          ease: 'power2.out',
        });
      });
    }
  });
</script>
