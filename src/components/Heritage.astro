---
// src/components/Heritage.astro
---
<section id="legado" class="relative py-32 md:py-48 bg-[var(--color-ivory)] overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 md:px-12">
    
    <!-- Header de Sección -->
    <div class="w-full flex flex-col items-center text-center mb-24 reveal-element">
      <div class="flex items-center justify-center gap-3 mb-6">
        <div class="w-8 h-px bg-[var(--color-bordeaux)]"></div>
        <h3 class="font-accent text-[var(--color-bordeaux)] text-xs md:text-sm tracking-[0.2em] uppercase">
          Nuestra Historia
        </h3>
        <div class="w-8 h-px bg-[var(--color-bordeaux)]"></div>
      </div>

      <h2 class="font-display text-4xl md:text-5xl lg:text-6xl text-[var(--color-noir)] leading-[1.1] max-w-2xl mx-auto">
        Cuatro Décadas de<br/>
        <span class="italic font-light text-[var(--color-oak)]">Excelencia</span>
      </h2>
    </div>

    <!-- Bloques Narrativos en Z-Pattern -->
    <div class="space-y-32">
      
      <!-- Fila 1: Orígenes -->
      <div class="flex flex-col md:flex-row items-center gap-12 lg:gap-24">
        <div class="w-full md:w-1/2 order-2 md:order-1 reveal-element">
          <div class="font-body text-[15px] md:text-base text-[var(--color-graphite)]/80 leading-[1.85] space-y-6 text-justify">
            <p>
              La historia de Caveduke no se escribe con líneas de ensamblaje, sino con el <em>aroma a roble viejo</em> y el <em>sonido del cincel</em>. Todo comenzó en <strong class="text-[var(--color-bordeaux)] font-semibold not-italic">1985</strong> en un pequeño taller artesanal en <em>Mollet del Vallès, Barcelona</em>. En una época donde el concepto de "vinoteca" apenas se entendía, nuestros fundadores tuvieron una visión clara: el vino, esa poesía embotellada, merecía un templo a su altura. No un mero electrodoméstico frío y sin alma, sino una pieza de mobiliario exquisita, confeccionada con las materias primas más nobles del mundo.
            </p>
            <p>
              Desde aquel lejano taller, las primeras Caveduke nacieron como <strong class="text-[var(--color-noir)] font-medium">encargos exclusivos</strong> para coleccionistas privados y pequeños châteaux. Seleccionamos rigurosamente maderas como el <em>nogal, el cerezo y el roble macizo</em>, tratadas con procesos de curación natural para evitar cualquier transferencia de olores. Nuestras puertas no son simples cierres; son arcos de triunfo acristalados que protegen su colección de los rayos UV mientras permiten su exhibición con orgullo.
            </p>
          </div>
        </div>
        
        <div class="w-full md:w-1/2 order-1 md:order-2">
          <div class="aspect-[4/5] overflow-hidden rounded-sm relative img-reveal">
            <div class="absolute inset-0 bg-[#e0d8cd] z-0"></div>
            <img 
              src="/images/heritage.png" 
              alt="Bodega de lujo tradicional" 
              class="w-full h-full object-cover relative z-10 hover:scale-105 transition-transform duration-[2s]"
              loading="eager"
            />
            <div class="absolute inset-0 border border-[var(--color-graphite)]/10 m-4 z-20 pointer-events-none"></div>
          </div>
        </div>
      </div>

      <!-- Fila 2: Innovación & Cita -->
      <div class="flex flex-col md:flex-row items-stretch gap-12 lg:gap-24">
        <div class="w-full md:w-[45%] flex flex-col justify-center">
          <figure class="w-full img-reveal aspect-[16/9] overflow-hidden rounded-sm relative mb-8">
            <div class="absolute inset-0 bg-[#e0d8cd] z-0"></div>
            <img 
              src="/images/craftsman.png" 
              alt="Maestro ebanista trabajando en una vinoteca Caveduke en su taller de Barcelona" 
              class="w-full h-full object-cover relative z-10 hover:scale-105 transition-transform duration-[2s]"
              loading="eager"
            />
            <div class="absolute inset-0 border border-[var(--color-graphite)]/10 m-3 z-20 pointer-events-none"></div>
          </figure>
          
          <div class="reveal-element">
            <blockquote class="border-l-2 border-[var(--color-bordeaux)] pl-5">
              <p class="font-body text-sm md:text-[15px] text-[var(--color-graphite)]/70 leading-relaxed italic">
                "Cada vinoteca es una promesa de silencio: el silencio en que el vino perfecciona su carácter lejos del ruido del mundo."
              </p>
              <footer class="mt-3 font-accent text-[10px] tracking-[0.25em] text-[var(--color-bordeaux)]/70 uppercase">
                — Fundadores de Caveduke, 1985
              </footer>
            </blockquote>

            <div class="flex items-center gap-4 pt-4">
              <div class="w-6 h-px bg-[var(--color-graphite)]/20 flex-shrink-0"></div>
              <p class="font-accent text-[10px] tracking-[0.22em] text-[var(--color-graphite)]/40 uppercase">
                Diseño artesanal · Barcelona, España
              </p>
            </div>
          </div>
        </div>

        <div class="w-full md:w-[55%] flex flex-col justify-center reveal-element">
          <div class="font-body text-[15px] md:text-base text-[var(--color-graphite)]/80 leading-[1.85] text-justify space-y-6">
            <p>
              Fue a principios de los años 90 cuando Caveduke revolucionó el mercado europeo introduciendo la <em>cámara de cristal Climalit</em>. Más tarde, fuimos pioneros en integrar sistemas de compresión amortiguada: una tecnología importada de la ingeniería aeroespacial que garantiza el <strong class="text-[var(--color-bordeaux)] font-semibold">&ldquo;Silencio Caveduke&rdquo;</strong> — una ausencia total de vibraciones que permite que los sedimentos del vino descansen en paz infinita.
            </p>
            <p>
              Rechazamos los sistemas termoeléctricos comunes por su inestabilidad frente a picos ambientales. Creamos un santuario donde la humedad relativa coquetea permanentemente con la cifra perfecta (65-75%), previniendo que los corchos envejezcan antes que sus caldos y asegurando decantaciones gloriosas.
            </p>
          </div>
        </div>
      </div>

      <!-- Fila 3: El Legado Actual -->
      <div class="flex flex-col md:flex-row items-center gap-12 lg:gap-24">
        
        <div class="w-full md:w-1/2 order-2 md:order-1 reveal-element">
          <div class="font-body text-[15px] md:text-base text-[var(--color-graphite)]/80 leading-[1.85] text-justify space-y-6">
            <p>
              Hoy, casi cuarenta años después, <strong class="text-[var(--color-bordeaux)] font-semibold">rechazamos categóricamente la producción masiva</strong>. Cada vinoteca Caveduke lleva grabada el alma de los ebanistas, ingenieros y sumilleres que han participado en su concepción. No existe el stock prefabricado; cada cliente entra en un diálogo íntimo con nuestros diseñadores, decidiendo dimensiones, tonos, capacidades y acabados.
            </p>
            <p>
              La expansión a <strong class="text-[var(--color-bordeaux)] font-semibold">cinco continentes</strong> no ha mermado nuestro espíritu de taller, lo ha engrandecido. Cuando un cliente de <em>Nueva York, Dubái o Tokio</em> recibe su Caveduke, no está comprando un enfriador de botellas; está heredando un legado del diseño español, una cámara acorazada de elegancia imperturbable donde el tiempo, la temperatura y la humedad se rinden ante la belleza de su colección privada. Caveduke es, en su esencia más pura, el silencio estético donde el vino aguarda su momento de gloria.
            </p>
          </div>
        </div>

        <div class="w-full md:w-1/2 order-1 md:order-2">
          <figure class="w-full img-reveal aspect-[4/3] md:aspect-[5/4] overflow-hidden rounded-sm relative">
            <div class="absolute inset-0 bg-[#e0d8cd] z-0"></div>
            <img 
              src="/images/vinoteca-inline.png" 
              alt="Vinoteca Caveduke a medida de nogal macizo con iluminación interior y puerta de cristal UV" 
              class="w-full h-full object-cover relative z-10 hover:scale-105 transition-transform duration-[2s]"
              loading="eager"
            />
            <div class="absolute inset-0 border border-[var(--color-graphite)]/10 m-3 z-20 pointer-events-none"></div>
            
            <figcaption class="absolute bottom-5 right-5 z-30 bg-[var(--color-ivory)]/90 backdrop-blur px-4 py-2 text-center rounded-sm border border-[var(--color-bordeaux)]/20 text-[var(--color-bordeaux)] shadow-[var(--shadow-gold)] font-accent text-[9px] tracking-[0.2em] uppercase">
              Colección Madera Noble
            </figcaption>
          </figure>
        </div>

      </div>

    </div>

    <!-- Contadores Finales -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-12 sm:gap-6 mt-32 pt-16 border-t border-[var(--color-graphite)]/10 reveal-element">
      
      <div class="flex flex-col items-center text-center">
        <div class="font-display text-6xl md:text-7xl text-[var(--color-bordeaux)] mb-3 flex items-baseline">
          <span class="counter" data-target="40">0</span>
        </div>
        <p class="font-accent text-xs tracking-[0.3em] text-[var(--color-graphite)]/80 uppercase">Años de Artesanía</p>
      </div>

      <div class="flex flex-col items-center text-center">
        <div class="font-display text-6xl md:text-7xl text-[var(--color-bordeaux)] mb-3 flex items-baseline">
          <span class="counter" data-target="5">0</span>
        </div>
        <p class="font-accent text-xs tracking-[0.3em] text-[var(--color-graphite)]/80 uppercase">Continentes Alcanzados</p>
      </div>

      <div class="flex flex-col items-center text-center">
        <div class="font-display text-6xl md:text-7xl text-[var(--color-bordeaux)] mb-3 flex items-baseline">
          +<span class="counter" data-target="67">0</span>k
        </div>
        <p class="font-accent text-xs tracking-[0.3em] text-[var(--color-graphite)]/80 uppercase">Coleccionistas Satisfechos</p>
      </div>

    </div>

  </div>
</section>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // Reveal clip path para todas las imágenes principales
  gsap.utils.toArray('.img-reveal').forEach((wrapper: any) => {
    gsap.fromTo(wrapper, 
      { clipPath: 'inset(100% 0 0 0)' },
      {
        clipPath: 'inset(0% 0 0 0)',
        duration: 1.5,
        ease: 'power4.inOut',
        scrollTrigger: {
          trigger: wrapper,
          start: 'top 95%',
        }
      }
    );
  });

  // Reveal standar para textos y contenedores
  gsap.utils.toArray('.reveal-element').forEach((element: any) => {
    gsap.fromTo(element, 
      { y: 40, opacity: 0 },
      {
        y: 0,
        opacity: 1,
        duration: 1,
        ease: 'power3.out',
        scrollTrigger: {
          trigger: element,
          start: 'top 95%',
        }
      }
    );
  });

  // Animate counters solo cuando llegan a la vista
  const counters = document.querySelectorAll('.counter');
  
  if (counters.length > 0) {
    ScrollTrigger.create({
      trigger: counters[0]?.parentElement?.parentElement?.parentElement, // El grid entero
      start: 'top 95%',
      once: true,
      onEnter: () => {
        counters.forEach(counter => {
          // @ts-ignore
          const target = parseInt(counter.dataset.target);
          gsap.to(counter, {
            innerText: target,
            duration: 2.5,
            snap: { innerText: 1 },
            ease: 'power2.out',
          });
        });
      }
    });
  }
</script>
